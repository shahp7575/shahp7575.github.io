<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Parth's Blog - Parth Shah</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Parth's Blog Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Parth's Blog </a></h1>
                <nav><ul>
                    <li><a href="/pages/about-me.html">About Me</a></li>
                    <li><a href="/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/scraping-laliga-statistics-201819.html">Scraping LaLiga Statistics 2018/19</a></h1>
<footer class="post-info">
        <abbr class="published" title="2019-08-19T00:00:00-04:00">
                Published: Mon 19 August 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/parth-shah.html">Parth Shah</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>

</footer><!-- /.post-info --><h2>Environment Setup</h2>
<p>I have used Python 3.6 for this tutorial. The required libraries are as follows:</p>
<ul>
<li>numpy</li>
<li>pandas</li>
<li>bs4 (BeautifulSoup)</li>
<li>urllib (Module for working with URLs)</li>
</ul>
<h2>Web Scraping from msn.com</h2>
<p><img alt="image" src="images/laliga-home.png"></p>
<p>The website lists the scores for each month on a separate page and it follows this pattern: </p>
<p><em>https://www.msn.com/en-us/sports/soccer/la-liga/scores/</em></p>
<p><em>https://www.msn.com/en-us/sports/soccer/la-liga/scores/sp-d-20190428</em></p>
<p><em>https://www.msn.com/en-us/sports/soccer/la-liga/scores/sp-d-20190428-d-20190331</em></p>
<p><em>https://www.msn.com/en-us/sports/soccer/la-liga/scores/sp-d-20190428-d-20190331-d-20190303</em></p>
<p>As we can see notice the pattern here:(<em>I</em>)</p>
<p>http://............./sp-d-(<em>new-match-date</em>)-d-(<em>past-date</em>)-d-(<em>past-date</em>).</p>
<p>I recorded those dates in a list and created a function that gives me all the links.</p>
<div class="highlight"><pre><span></span><span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;20190428&#39;</span><span class="p">,</span> <span class="s1">&#39;20190331&#39;</span><span class="p">,</span> <span class="s1">&#39;20190303&#39;</span><span class="p">,</span> <span class="s1">&#39;20190203&#39;</span><span class="p">,</span> <span class="s1">&#39;20190106&#39;</span><span class="p">,</span> <span class="s1">&#39;20181209&#39;</span><span class="p">,</span> <span class="s1">&#39;20181111&#39;</span><span class="p">,</span> <span class="s1">&#39;20181014&#39;</span><span class="p">,</span> <span class="s1">&#39;20180916&#39;</span><span class="p">,</span> <span class="s1">&#39;20180819&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">fetch_website</span><span class="p">(</span><span class="n">links</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.msn.com/en-us/sports/soccer/la-liga/scores/&#39;</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;sp&#39;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">(</span><span class="n">links</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;-d-&#39;</span> <span class="o">+</span> <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">urls</span>

<span class="n">urls</span> <span class="o">=</span> <span class="n">fetch_website</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
</pre></div>


<p><code>['https://www.msn.com/en-us/sports/soccer/la-liga/scores/',
 'https://www.msn.com/en-us/sports/soccer/la-liga/scores/sp-d-20190428',
 'https://www.msn.com/en-us/sports/soccer/la-liga/scores/sp-d-20190428-d-20190331',
 'https://www.msn.com/en-us/sports/soccer/la-liga/scores/sp-d-20190428-d-20190331-d-20190303'...]</code></p>
<p>Once we have the links, all we have to do is create a script that runs through all the links and gives us the desired output. The page source of the web page looks like this:</p>
<p><img alt="image" src="images/laliga-pagesource.jpg"></p>
<p>Our scores are listed in the <em>sectionsgroup</em> container. Each team scores are in a <em>tbody</em> tag distributed by <em>even rowlink</em> and <em>odd rownlink</em> classes. Now we can use the power of BeautifulSoup to scrape the contents with just two functions:</p>
<ul>
<li><em>find</em>: This function takes the name of the tag as string input and returns the first found match from the webpage. <ul>
<li>Here we will find the <em>div</em> container with class <em>sectionsgroup</em> that contains all the score results.</li>
</ul>
</li>
<li><em>findAll</em>: to extract all the occurrences of a particular tag from the page.<ul>
<li>Here we will <em>findAll</em> the <em>tbody</em> tags with classes <em>even rowlink</em> &amp; <em>odd rowlink</em> and then loop through each of them to get the contents.</li>
</ul>
</li>
</ul>
<p>The following is the code to scrape just one webpage:</p>
<div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.msn.com/en-us/sports/soccer/la-liga/scores/&#39;</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;sectionsgroup&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;even rowlink&#39;</span><span class="p">,</span> <span class="s1">&#39;odd rowlink&#39;</span><span class="p">]})</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="n">home_team</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;teamname teaminline alignright size23&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">away_team</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;teamname size23&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">match_date</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;groupingcolumn paddingleft&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;matchdate&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;teamscore&#39;</span><span class="p">})</span>

    <span class="n">home_team_score</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">away_team_score</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">data_link</span> <span class="o">=</span> <span class="s1">&#39;https://www.msn.com&#39;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
</pre></div>


<p>This gives us the team names, match date, their scores and the <em>data_link</em>(link that takes us to a separate page for detailed statistics of each match) using just <em>find</em> and <em>findAll</em> tags. Now to run through all pages we just have to run this for each and every link and append the results to a list.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_html</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="n">teams</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;sectionsgroup&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;even rowlink&#39;</span><span class="p">,</span> <span class="s1">&#39;odd rowlink&#39;</span><span class="p">]})</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">home_team</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;teamname teaminline alignright size23&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">away_team</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;teamname size23&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">match_date</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;groupingcolumn paddingleft&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;matchdate&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;teamscore&#39;</span><span class="p">})</span>

            <span class="n">home_team_score</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">away_team_score</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="n">data_link</span> <span class="o">=</span> <span class="s1">&#39;https://www.msn.com&#39;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>

            <span class="n">teams</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">match_date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">match_date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">home_team</span><span class="p">,</span> <span class="n">away_team</span><span class="p">,</span>
                          <span class="n">home_team_score</span><span class="p">,</span> <span class="n">away_team_score</span><span class="p">,</span> <span class="n">data_link</span><span class="p">])</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">teams</span>
</pre></div>


<p>This gives us results for each match in a list that can be easily converted into a dataframe. </p>
<p><code>[['Sun',
  'May 19',
  'Eibar',
  'Barça',
  '2',
  '2',
  'https://www.msn.com/en-us/sports/soccer/la-liga/eibar-v-barcelona/game-center/sp-id-80402000001009693'],
 ['Sun',
  'May 19',
  'Real Madrid',
  'Betis',
  '0',
  '2',
  'https://www.msn.com/en-us/sports/soccer/la-liga/real-madrid-v-real-betis/game-center/sp-id-80402000001009694'],
  ...
 ]</code></p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/data-preprocessing.html" rel="bookmark"
                           title="Permalink to Data Preprocessing">Data Preprocessing</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-11-14T00:00:00-05:00">
                Published: Wed 14 November 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/parth-shah.html">Parth Shah</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>

</footer><!-- /.post-info -->                <p><img alt="image" src="images/ml.png"></p>
<p>It was 6 pm on October 17th, 2018, when the wind came crashing at my window. I woke up from my little nap and as usual — I picked up my phone and went to YouTube. Well thanks to YouTube for recommending me this Siraj Raval’s video, where he simply …</p>
                <a class="readmore" href="/data-preprocessing.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/anscombes-quartet.html" rel="bookmark"
                           title="Permalink to Anscombe's Quartet">Anscombe's Quartet</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-09-19T00:00:00-04:00">
                Published: Wed 19 September 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/parth-shah.html">Parth Shah</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>

</footer><!-- /.post-info -->                <p>I always believed in “numerical calculations are exact, but graphs are rough”. Coming from a person who has just started learning Data Analytics, it was hard for me to understand the importance of Data Visualization along with summary statistics. But it all changed after attending this Data Visualization Meetup, which …</p>
                <a class="readmore" href="/anscombes-quartet.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>